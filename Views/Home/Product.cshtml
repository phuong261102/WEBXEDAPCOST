@model List<App.Models.Product>
@using App.Components

@{
    List<Category> categories = ViewBag.categories as List<Category>;
    List<Brand> brands = ViewBag.brands as List<Brand>;
    Category category = ViewBag.category as Category;

    ViewData[("Title")] = "Sản phẩm";

}

@section Popup {
    @await Component.InvokeAsync(CategorySideBar.COMPONENTNAME,
        new CategorySideBar.CategorySideBarData
{
    level = 0,
    Categories = categories,
    slugCategory = ViewBag.categoryslug as string,
    brands = brands,
    slugBrand = ViewBag.brandslug as string
})
}

<style>
    .product-item {
        margin-bottom: 10px;
        border: 3px solid #ddd;
        border-radius: 10px;
    }
</style>

<body style="padding-bottom: 50px;">
    <div class="main_bicycle_shop">
        <div class="grid">
            <div class="is-large">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a style="text-decoration: none; color: rgba(102, 102, 102, .7);" href="~/">Home </a></li>
                        <li class="breadcrumb-item"><a style="text-decoration: none; color: rgba(102, 102, 102, .7);" asp-action="Product">Product </a></li>

                        @if (category != null)
                        {
                            var li = category.ListParentsAndSelf();
                            foreach (var i in li)
                            {
                                <li class="breadcrumb-item">
                                    <a asp-action="Product" asp-route-categoryslug="@i.Slug">
                                        @i.Title
                                    </a>
                                </li>
                            }
                        }
                        else if (!string.IsNullOrEmpty(ViewBag.brandslug))
                        {
                            var brand = brands.FirstOrDefault(b => b.Slug == ViewBag.brandslug);
                            <li class="breadcrumb-item"><a href="">Thương hiệu</a></li>
                            if (brand != null)
                            {
                                <li class="breadcrumb-item">
                                    <a asp-action="Product" asp-route-brandslug="@brand.Slug">
                                        @brand.Name
                                    </a>
                                </li>
                            }
                        }
                    </ol>
                </nav>
                <div class="medium-text-center">
                    <form action="" class="woocommerce-ordering" method="get">
                        <select name="orderby" id="orderby" aria-label="Shop order">
                            <option value="date">Mới nhất</option>
                            <option value="popularity">Thứ tự theo mức độ phổ biến</option>
                            <option value="price">Thứ tự theo giá: thấp đến cao</option>
                            <option value="price">Thứ tự theo giá: cao xuống thấp</option>
                        </select>
                    </form>
                </div>
            </div>
            <div class="main_bicycle">
                @await Html.PartialAsync("_ProductSidebar")
                <div class="mainshop" id="wrapper_mainshop">
                    <div class="headline headline_mainshop" style="padding-top: 0; padding-left: 5%;">Shop</div>
                    <div class="content_shop">
                        <ul class="products">
                            @foreach (var product in Model)
                            {
                                var categoryOrBrandSlug = product.Brand?.Slug ??
                                product.ProductCategories
                                .FirstOrDefault()?.Category.Slug;

                                <li class="product-item">
                                    <div class="product-top">
                                        <a asp-action="DetailProduct" asp-controller="Home"
                                            asp-route-categoryslug="@categoryOrBrandSlug"
                                            asp-route-productslug="@product.Slug" class="product-thumb">
                                            <img src="@Url.Content("~/images/products/" + product.Slug + "/" + product.MainImage)"
                                                alt="@product.Name">
                                        </a>
                                    </div>
                                    <div class="product-info">
                                        <a asp-action="DetailProduct" asp-controller="Home"
                                            asp-route-categoryslug="@categoryOrBrandSlug"
                                            asp-route-productslug="@product.Slug" class="product-name">@product.Name</a>
                                        <div class="product-price">
                                            @if (product.DiscountPrice.HasValue)
                                            {
                                                <span style="text-decoration: line-through;">@product.Price.ToString("N0")
                                                    VND</span>
                                                <br />
                                                <span>@product.DiscountPrice.Value.ToString("N0") VND</span>
                                            }
                                            else
                                            {
                                                <span>@product.Price.ToString("N0") VND</span>
                                            }
                                        </div>
                                    </div>
                                </li>
                            }
                        </ul>
                        <div class="justify-content-center d-flex flex-wrap ps-3 pe-3 z-3 mb-5">
                            <partial name="_PagingXTL" model="@ViewBag.pagingmodel" />
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

